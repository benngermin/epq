<!DOCTYPE html>
<html>
<head>
    <title>SSE Debug Test</title>
</head>
<body>
    <div id="output"></div>
    <button onclick="testSSE()">Test SSE with EventSource</button>
    <button onclick="testFetch()">Test SSE with Fetch</button>
    
    <script>
    function testSSE() {
        console.log("Testing with EventSource...");
        const output = document.getElementById('output');
        output.innerHTML = "Testing EventSource...<br>";
        
        // EventSource doesn't support POST, so this will show the limitation
        const eventSource = new EventSource('/api/test-sse-get');
        
        eventSource.onopen = function(e) {
            console.log("EventSource connection opened");
            output.innerHTML += "EventSource: Connection opened<br>";
        };
        
        eventSource.onmessage = function(e) {
            console.log("EventSource message:", e.data);
            output.innerHTML += "EventSource Message: " + e.data + "<br>";
        };
        
        eventSource.onerror = function(e) {
            console.error("EventSource error:", e);
            output.innerHTML += "EventSource Error<br>";
            eventSource.close();
        };
    }
    
    async function testFetch() {
        console.log("Testing with Fetch...");
        const output = document.getElementById('output');
        output.innerHTML += "<br>Testing Fetch...<br>";
        
        try {
            const response = await fetch('/api/chatbot/stream', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'text/event-stream',
                },
                body: JSON.stringify({
                    questionVersionId: 577,
                    chosenAnswer: "A"
                }),
                credentials: 'include'
            });
            
            console.log("Fetch response:", response.status, response.headers.get('content-type'));
            output.innerHTML += `Fetch Response: ${response.status} ${response.headers.get('content-type')}<br>`;
            
            if (!response.ok) {
                const text = await response.text();
                output.innerHTML += `Error: ${text}<br>`;
                return;
            }
            
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            
            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                
                const chunk = decoder.decode(value);
                console.log("Fetch chunk:", chunk);
                output.innerHTML += `Chunk: ${chunk.replace(/\n/g, '\\n')}<br>`;
            }
            
        } catch (error) {
            console.error("Fetch error:", error);
            output.innerHTML += `Fetch Error: ${error.message}<br>`;
        }
    }
    </script>
</body>
</html>